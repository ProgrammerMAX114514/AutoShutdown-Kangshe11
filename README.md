# 自动关机实用程序 (Auto Shutdown Utility)

一个基于 Python 开发的轻量级桌面工具，支持定时自动关机、用户确认弹窗、后台托盘运行等功能，适用于 Windows 系统。

---

## 🌟 功能特性

- ✅ **定时关机计划**：支持在每天预设的时间点（如中午、晚上）自动执行关机任务。
- ✅ **关机前确认**：关机前会弹出图形化提示窗口，用户可选择【继续关机】或【取消关机】。
- ✅ **后台静默运行**：程序运行时以系统托盘图标形式驻留后台，不干扰用户正常使用电脑。
- ✅ **开机自启提醒**：程序首次启动时会通过 Windows 通知提醒用户。
- ✅ **防多开保护**：通过系统互斥锁防止程序重复运行。
- ✅ **管理员权限检测**：自动检测是否以管理员身份运行，非管理员身份可能影响关机功能。
- ✅ **日志记录**：每次运行都会生成带有时间戳的日志文件，便于排查问题。
- ✅ **线程安全 GUI**：使用 `root.after` 保证弹窗等 GUI 操作在主线程执行，避免多线程冲突。

---

## 📦 如何运行

### 1. 环境要求

- 操作系统：Windows 7 / 10 / 11
- Python 版本：建议 Python 3.7 及以上（已测试 Python 3.13）
- 依赖库：请通过以下命令安装所需第三方库

### 2. 安装依赖

在项目目录下打开 CMD / PowerShell，运行：

```bash
pip install pystray pillow win10toast
```

> ⚠️ 本项目依赖 `pystray`（系统托盘）、`Pillow`（图标处理）、`win10toast`（Windows 通知）。

### 3. 运行程序

确保当前目录包含以下必要文件：

- 本脚本文件（`AutoShutdown-Kangshe11.py`）
- 图标文件：`icon.ico`（程序托盘图标，一般情况下已经默认附带了）

然后运行：

```bash
python AutoShutdown-Kangshe11.py
```

> 程序启动后会在后台静默运行，右下角系统托盘中可看到对应图标，右键点击可退出程序。

---

## 📁 项目文件说明（简要）

| 文件                      | 说明                                               |
| ------------------------- | -------------------------------------------------- |
| AutoShutdown-Kangshe11.py | 主程序文件，包含所有核心功能（已带少量英文注释）   |
| icon.ico                  | 系统托盘图标文件（已附带默认图标）                 |
| logs/                     | 程序运行时自动生成的日志文件夹，按日期保存日志文件 |
| config.json               | 配置文件（必须）                                   |

> 当前版本为单一文件程序，所有功能集中在一个脚本中，便于理解与维护。

---

## ▶️ 使用方法

1. **双击运行脚本** 或通过命令行启动。
2. 程序启动后会在 **后台静默运行**，并在右下角系统托盘显示图标。
3. 弹出 Windows 通知提醒。
4. 程序会根据预设的时间（如中午、晚上）自动尝试执行关机，关机前会弹出确认窗口。
5. 如需退出程序，请 **右键点击系统托盘图标，选择“退出”**。

> ⚠️ 如果没有看到托盘图标，请检查程序是否正常启动，或查看日志文件排查问题。

---

## ⚠️ 注意事项

- 本程序仅适用于 **Windows 系统**。
- 必须保证图标文件 `icon.ico` 存放在程序目录下，否则托盘功能可能异常。
- 程序会尝试以管理员权限运行部分功能（如关机命令），建议以管理员身份运行以确保功能完整。
- 如果程序无法正常弹出关机确认窗口，请确保没有安全软件拦截 tkinter 弹窗。
- 程序运行后会生成 `logs/` 文件夹，用于保存运行日志，便于排查问题。

---

## 📄 开源协议

本项目使用MIT协议，详情请参见LICENSE。

---

## 🤝 联系方式 / 贡献

- 作者：WuRuizhao
- 当前版本：v0.3.0-dev
- 欢迎提出 Issue 或 Pull Request。
- 如你有改进建议、Bug 反馈，或想要添加新功能（如自定义关机时间 GUI、配置文件编辑器等），欢迎联系！

---

享受高效、安全的自动关机管理吧！ 🚀
